<!doctype html><meta charset="utf-8">
<title>Text Drift Report</title>
<style>
body{font-family:Inter,Arial,sans-serif;margin:24px;line-height:1.45}
h1,h2{margin:.2em 0}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
table{border-collapse:collapse} th,td{border:1px solid #ddd;padding:6px 10px}
.small{color:#777}
.card{padding:12px;border:1px solid #eee;border-radius:12px}
.kpi{font-size:28px;font-weight:700}
</style>

<h1>Text Drift Report</h1>
<p class="small">Reference n={{n_ref}} | Current n={{n_cur}}</p>

<div class="grid">
  <div class="card">
    <h2>Length Histogram</h2>
    <img src="{{len_img}}" style="max-width:100%">
    <table>
      <tr><th></th><th>mean</th><th>median</th><th>p95</th></tr>
      <tr>
        <td>ref</td>
        <td>{{ref_len_stats.mean|round(1)}}</td>
        <td>{{ref_len_stats.median|round(1)}}</td>
        <td>{{ref_len_stats.p95|round(1)}}</td>
      </tr>
      <tr>
        <td>cur</td>
        <td>{{cur_len_stats.mean|round(1)}}</td>
        <td>{{cur_len_stats.median|round(1)}}</td>
        <td>{{cur_len_stats.p95|round(1)}}</td>
      </tr>
    </table>
  </div>

  <div class="card">
    <h2>Vocab Shift</h2>
    <p>JS divergence: <span class="kpi">{{js_vocab|round(4)}}</span></p>
    <img src="{{tok_img}}" style="max-width:100%">
    <h3>Top token shifts</h3>
    <table>
      <tr><th>token</th><th>ref</th><th>cur</th><th>Δ</th></tr>
      {% for r in top_tokens %}
      <tr>
        <td>{{r.token}}</td>
        <td>{{r.ref}}</td>
        <td>{{r.cur}}</td>
        <td>{{r.delta}}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>

<div class="grid" style="margin-top:24px">
  <div class="card">
    <h2>Embedding Drift</h2>
    <p>Mean embedding cosine similarity:
      <span class="kpi">{{mean_cos|round(4)}}</span>
    </p>
    <p>Energy distance (lower ≈ closer):
      <span class="kpi">{{emb_energy|round(4)}}</span>
    </p>
    <p class="small">Model: sentence-transformers/all-MiniLM-L6-v2</p>
  </div>

  <div class="card">
    <h2>Output Drift (Intent)</h2>
    {% if o_js is not none %}
      <p>Label distribution JS:
        <span class="kpi">{{o_js|round(4)}}</span>
      </p>
      <p>Δ mean confidence:
        <span class="kpi">{{conf_shift|round(4)}}</span>
      </p>
      <p class="small">Confidence = max softmax score dari model DistilBERT intent.</p>
    {% else %}
      <p class="small">
        Output drift belum dihitung karena <code>models/intent_distilbert</code> tidak ditemukan.
        Training / export dulu model intent untuk mengaktifkan bagian ini.
      </p>
    {% endif %}
  </div>
</div>

<p class="small" style="margin-top:24px">
Generated by <code>tools/drift_report.py</code>
</p>
